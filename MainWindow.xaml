<Window x:Class="ComponentDiffEditor.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:avalon="http://icsharpcode.net/sharpdevelop/avalonedit"
        Title="Component Diff Editor - Milling Script Component Standardization Tool"
        Height="800" Width="1400"
        WindowState="Maximized">

    <Window.Resources>
        <Style TargetType="Button">
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="MinWidth" Value="80"/>
        </Style>

        <Style TargetType="TextBlock">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="5,2"/>
        </Style>

        <Style x:Key="SimilarityTextStyle" TargetType="TextBlock">
            <Setter Property="FontWeight" Value="Bold"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding Similarity, Converter={StaticResource SimilarityToColorConverter}}" Value="Red">
                    <Setter Property="Foreground" Value="Red"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Similarity, Converter={StaticResource SimilarityToColorConverter}}" Value="Orange">
                    <Setter Property="Foreground" Value="Orange"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Similarity, Converter={StaticResource SimilarityToColorConverter}}" Value="Green">
                    <Setter Property="Foreground" Value="Green"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header Controls -->
        <Border Grid.Row="0" Background="#2C3E50" Padding="10">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="🧩 Component Diff Editor" Foreground="White" FontSize="16" FontWeight="Bold" VerticalAlignment="Center"/>
                <Rectangle Width="20"/>
                <TextBlock Text="Component:" Foreground="White" VerticalAlignment="Center"/>
                <ComboBox ItemsSource="{Binding ComponentTypes}"
                         SelectedItem="{Binding SelectedComponentType}"
                         Width="240" Margin="5,0" VerticalAlignment="Center"/>
                <Rectangle Width="10"/>
                <Button Content="🔍 Load" Command="{Binding LoadComponentsCommand}"/>
                <Button Content="🔄 Refresh" Command="{Binding RefreshCommand}"/>
                <Rectangle Width="15"/>
                <Button Content="💾 Save Default" Command="{Binding SaveDefaultCommand}"/>
                <Button Content="🚀 Apply Selected" Command="{Binding ApplyToSelectedFilesCommand}"/>
            </StackPanel>
        </Border>

        <!-- Path Configuration -->
        <Grid Grid.Row="1" Background="#ECF0F1" Margin="5">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Row="0" Grid.Column="0" Text="📁 Script Folder:" FontWeight="Bold"/>
            <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding ScriptFolderPath}" Margin="5,2"/>

            <TextBlock Grid.Row="1" Grid.Column="0" Text="📦 Components:" FontWeight="Bold"/>
            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding DefaultComponentsPath}" Margin="5,2"/>
        </Grid>

        <!-- Main Content -->
        <Grid Grid.Row="2" Margin="5">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1*"/>
                <ColumnDefinition Width="1*"/>
                <ColumnDefinition Width="1*"/>
            </Grid.ColumnDefinitions>

            <!-- Default Component Panel -->
            <GroupBox Grid.Column="0" Header="📋 Default Component Template" Margin="5">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <avalon:TextEditor Grid.Row="0"
                                     Document="{Binding DefaultComponentXml, Converter={StaticResource StringToDocumentConverter}}"
                                     SyntaxHighlighting="XML"
                                     FontFamily="Consolas"
                                     FontSize="12"
                                     ShowLineNumbers="True"
                                     Margin="5"/>

                    <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="📝 Edit"/>
                        <Button Content="💾 Save" Command="{Binding SaveDefaultCommand}"/>
                    </StackPanel>
                </Grid>
            </GroupBox>

            <!-- Current Component Panel -->
            <GroupBox Grid.Column="1" Header="🔍 Selected Component" Margin="5">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Selected File Info -->
                    <Border Grid.Row="0" Background="#3498DB" Padding="5" Margin="0,0,0,5">
                        <StackPanel>
                            <TextBlock Text="{Binding SelectedComponentFile.DisplayName}"
                                     Foreground="White" FontWeight="Bold"/>
                            <TextBlock Text="{Binding SelectedComponentFile.FormattedSimilarity, StringFormat=Similarity: \{0\}}"
                                     Foreground="White"/>
                        </StackPanel>
                    </Border>

                    <avalon:TextEditor Grid.Row="1"
                                     Document="{Binding CurrentComponentXml, Converter={StaticResource StringToDocumentConverter}}"
                                     SyntaxHighlighting="XML"
                                     FontFamily="Consolas"
                                     FontSize="12"
                                     ShowLineNumbers="True"
                                     IsReadOnly="True"
                                     Margin="5"/>

                    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="📋 Copy From" Command="{Binding CopyFromFileCommand}" CommandParameter="{Binding SelectedComponentFile}"/>
                        <Button Content="▲ Apply To" Command="{Binding ApplyToFileCommand}" CommandParameter="{Binding SelectedComponentFile}"/>
                    </StackPanel>
                </Grid>
            </GroupBox>

            <!-- File List & Differences Panel -->
            <Grid Grid.Column="2" Margin="5">
                <Grid.RowDefinitions>
                    <RowDefinition Height="2*"/>
                    <RowDefinition Height="1*"/>
                </Grid.RowDefinitions>

                <!-- Component Files List -->
                <GroupBox Grid.Row="0" Header="📂 Component Files">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Selection Controls -->
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5">
                            <Button Content="☑ All" Command="{Binding SelectAllCommand}"/>
                            <Button Content="☐ None" Command="{Binding DeselectAllCommand}"/>
                            <TextBlock Text="{Binding ComponentFiles.Count, StringFormat=\{0\} files}"
                                     VerticalAlignment="Center" Margin="10,0,0,0"/>
                        </StackPanel>

                        <ListView Grid.Row="1"
                                ItemsSource="{Binding ComponentFiles}"
                                SelectedItem="{Binding SelectedComponentFile}"
                                Margin="5">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Width="30">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <CheckBox IsChecked="{Binding IsSelected}"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>

                                    <GridViewColumn Header="File" Width="200">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding DisplayName}" ToolTip="{Binding FileName}"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>

                                    <GridViewColumn Header="Similarity" Width="80">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding FormattedSimilarity}"
                                                         Style="{StaticResource SimilarityTextStyle}"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>

                                    <GridViewColumn Header="Actions" Width="100">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal">
                                                    <Button Content="📋" Width="25" Height="20"
                                                          Command="{Binding DataContext.CopyFromFileCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                                          CommandParameter="{Binding}"
                                                          ToolTip="Copy from this file"/>
                                                    <Button Content="▲" Width="25" Height="20"
                                                          Command="{Binding DataContext.ApplyToFileCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                                          CommandParameter="{Binding}"
                                                          ToolTip="Apply default to this file"/>
                                                </StackPanel>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </Grid>
                </GroupBox>

                <!-- Differences Panel -->
                <GroupBox Grid.Row="1" Header="🔍 Differences" Margin="0,5,0,0">
                    <ListView ItemsSource="{Binding CurrentDifferences}">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="Path" Width="150" DisplayMemberBinding="{Binding Path}"/>
                                <GridViewColumn Header="Default" Width="80" DisplayMemberBinding="{Binding DefaultValue}"/>
                                <GridViewColumn Header="Actual" Width="80" DisplayMemberBinding="{Binding ActualValue}"/>
                                <GridViewColumn Header="Type" Width="60">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border CornerRadius="3" Padding="3,1">
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Type}" Value="Different">
                                                                <Setter Property="Background" Value="#E74C3C"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding Type}" Value="Missing">
                                                                <Setter Property="Background" Value="#F39C12"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding Type}" Value="Extra">
                                                                <Setter Property="Background" Value="#9B59B6"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding Type}" Value="Identical">
                                                                <Setter Property="Background" Value="#27AE60"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                                <TextBlock Text="{Binding TypeDisplay}"
                                                         Foreground="White"
                                                         FontSize="10"
                                                         HorizontalAlignment="Center"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </GroupBox>
            </Grid>
        </Grid>

        <!-- Status Bar -->
        <StatusBar Grid.Row="3">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusText}"/>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <ProgressBar Width="200" Height="16"
                           IsIndeterminate="{Binding IsLoading}"
                           Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>